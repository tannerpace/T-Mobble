<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crop & Resize Lil Raptor</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      padding: 20px;
      background: #f0f0f0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
    }

    .canvas-container {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .canvas-box {
      border: 2px solid #333;
      padding: 10px;
      background: #fff;
    }

    canvas {
      border: 1px dashed #999;
      background: white;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    .controls {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 5px;
    }

    label {
      display: inline-block;
      width: 150px;
      margin: 10px 0;
    }

    input[type="number"] {
      width: 80px;
      padding: 5px;
      font-family: 'Courier New', monospace;
    }

    button {
      background: #535353;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      border-radius: 4px;
    }

    button:hover {
      background: #333;
    }

    .info {
      background: #e3f2fd;
      padding: 10px;
      margin: 10px 0;
      border-left: 4px solid #2196F3;
    }

    .download-btn {
      background: #4CAF50;
      font-size: 16px;
      padding: 12px 24px;
    }

    .download-btn:hover {
      background: #45a049;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ðŸ¦– Crop & Resize Lil Raptor</h1>

    <div class="info">
      <strong>Goal:</strong> Remove white space around lil_raptor.png and resize to fit the game (target: 40x44 pixels)
    </div>

    <div class="controls">
      <h3>Manual Crop Adjustments</h3>
      <div>
        <label>Crop Left:</label>
        <input type="number" id="cropLeft" value="0" min="0">
      </div>
      <div>
        <label>Crop Right:</label>
        <input type="number" id="cropRight" value="0" min="0">
      </div>
      <div>
        <label>Crop Top:</label>
        <input type="number" id="cropTop" value="0" min="0">
      </div>
      <div>
        <label>Crop Bottom:</label>
        <input type="number" id="cropBottom" value="0" min="0">
      </div>
      <div>
        <label>Target Width:</label>
        <input type="number" id="targetWidth" value="40" min="1">
      </div>
      <div>
        <label>Target Height:</label>
        <input type="number" id="targetHeight" value="44" min="1">
      </div>
      <div style="margin-top: 15px;">
        <button onclick="autoCrop()">Auto Crop White Space</button>
        <button onclick="applyCrop()">Apply Manual Crop</button>
        <button onclick="resetCrop()">Reset</button>
      </div>
    </div>

    <div class="canvas-container">
      <div class="canvas-box">
        <h3>Original Image</h3>
        <canvas id="originalCanvas"></canvas>
        <p id="originalInfo"></p>
      </div>

      <div class="canvas-box">
        <h3>Cropped Image</h3>
        <canvas id="croppedCanvas"></canvas>
        <p id="croppedInfo"></p>
      </div>

      <div class="canvas-box">
        <h3>Final Resized (for game)</h3>
        <canvas id="finalCanvas" width="40" height="44"></canvas>
        <p id="finalInfo"></p>
      </div>
    </div>

    <div style="text-align: center; margin-top: 20px;">
      <button class="download-btn" onclick="downloadImage()">ðŸ’¾ Download lil_raptor_game.png</button>
    </div>

    <div class="info" style="margin-top: 20px;">
      <strong>Instructions:</strong>
      <ol>
        <li>Click "Auto Crop White Space" to automatically detect and remove white borders</li>
        <li>Adjust crop values manually if needed</li>
        <li>Check the "Final Resized" preview (40x44 pixels)</li>
        <li>Click "Download" to save the processed image</li>
        <li>Replace the trex.png reference in game.js with the new file</li>
      </ol>
    </div>
  </div>

  <script>
    const img = new Image();
    let originalImageData = null;
    let cropBounds = { left: 0, right: 0, top: 0, bottom: 0 };

    img.onload = function () {
      console.log('Image loaded:', img.width, 'x', img.height);
      drawOriginal();
      // Auto-crop on load
      setTimeout(() => autoCrop(), 100);
    };

    img.onerror = function () {
      alert('Error loading lil_raptor.png. Make sure the file exists in the same directory.');
    };

    img.src = 'lil_raptor.png';

    function drawOriginal() {
      const canvas = document.getElementById('originalCanvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);

      // Store original image data
      originalImageData = ctx.getImageData(0, 0, img.width, img.height);

      document.getElementById('originalInfo').textContent =
        `Size: ${img.width} x ${img.height} pixels`;
    }

    function isWhitePixel(data, index, tolerance = 240) {
      const r = data[index];
      const g = data[index + 1];
      const b = data[index + 2];
      const a = data[index + 3];

      // Consider pixel white if RGB values are high or alpha is very low
      return (a < 10) || (r > tolerance && g > tolerance && b > tolerance);
    }

    function autoCrop() {
      if (!originalImageData) return;

      const data = originalImageData.data;
      const width = originalImageData.width;
      const height = originalImageData.height;

      // Find top
      let top = 0;
      topLoop: for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const index = (y * width + x) * 4;
          if (!isWhitePixel(data, index)) {
            top = y;
            break topLoop;
          }
        }
      }

      // Find bottom
      let bottom = 0;
      bottomLoop: for (let y = height - 1; y >= 0; y--) {
        for (let x = 0; x < width; x++) {
          const index = (y * width + x) * 4;
          if (!isWhitePixel(data, index)) {
            bottom = height - 1 - y;
            break bottomLoop;
          }
        }
      }

      // Find left
      let left = 0;
      leftLoop: for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          const index = (y * width + x) * 4;
          if (!isWhitePixel(data, index)) {
            left = x;
            break leftLoop;
          }
        }
      }

      // Find right
      let right = 0;
      rightLoop: for (let x = width - 1; x >= 0; x--) {
        for (let y = 0; y < height; y++) {
          const index = (y * width + x) * 4;
          if (!isWhitePixel(data, index)) {
            right = width - 1 - x;
            break rightLoop;
          }
        }
      }

      console.log('Auto-crop detected:', { top, bottom, left, right });

      // Update input fields
      document.getElementById('cropTop').value = top;
      document.getElementById('cropBottom').value = bottom;
      document.getElementById('cropLeft').value = left;
      document.getElementById('cropRight').value = right;

      applyCrop();
    }

    function applyCrop() {
      const cropLeft = parseInt(document.getElementById('cropLeft').value) || 0;
      const cropRight = parseInt(document.getElementById('cropRight').value) || 0;
      const cropTop = parseInt(document.getElementById('cropTop').value) || 0;
      const cropBottom = parseInt(document.getElementById('cropBottom').value) || 0;

      const newWidth = img.width - cropLeft - cropRight;
      const newHeight = img.height - cropTop - cropBottom;

      if (newWidth <= 0 || newHeight <= 0) {
        alert('Invalid crop values!');
        return;
      }

      // Draw cropped image
      const croppedCanvas = document.getElementById('croppedCanvas');
      croppedCanvas.width = newWidth;
      croppedCanvas.height = newHeight;
      const croppedCtx = croppedCanvas.getContext('2d');

      croppedCtx.drawImage(
        img,
        cropLeft, cropTop, newWidth, newHeight,
        0, 0, newWidth, newHeight
      );

      document.getElementById('croppedInfo').textContent =
        `Size: ${newWidth} x ${newHeight} pixels`;

      // Draw final resized image
      const targetWidth = parseInt(document.getElementById('targetWidth').value) || 40;
      const targetHeight = parseInt(document.getElementById('targetHeight').value) || 44;

      const finalCanvas = document.getElementById('finalCanvas');
      finalCanvas.width = targetWidth;
      finalCanvas.height = targetHeight;
      const finalCtx = finalCanvas.getContext('2d');

      // Use better image scaling
      finalCtx.imageSmoothingEnabled = false;
      finalCtx.drawImage(croppedCanvas, 0, 0, targetWidth, targetHeight);

      document.getElementById('finalInfo').textContent =
        `Size: ${targetWidth} x ${targetHeight} pixels (game size)`;
    }

    function resetCrop() {
      document.getElementById('cropLeft').value = 0;
      document.getElementById('cropRight').value = 0;
      document.getElementById('cropTop').value = 0;
      document.getElementById('cropBottom').value = 0;
      applyCrop();
    }

    function downloadImage() {
      const finalCanvas = document.getElementById('finalCanvas');
      const link = document.createElement('a');
      link.download = 'lil_raptor_game.png';
      link.href = finalCanvas.toDataURL('image/png');
      link.click();

      alert('Image downloaded! You can now use "lil_raptor_game.png" in your game.');
    }

    // Auto-apply crop when inputs change
    ['cropLeft', 'cropRight', 'cropTop', 'cropBottom', 'targetWidth', 'targetHeight'].forEach(id => {
      document.getElementById(id).addEventListener('input', applyCrop);
    });
  </script>
</body>

</html>